  <head>
     
    <!-- <link href="../../../view/bootstrap/css/bootstrap.min.css" rel="stylesheet"> -->
     <link href=" view/js/layer/skin/layerpkq.css" rel="stylesheet"> 
     
  </head>
    <div class="Title">  
     便利券
     
</div>  
 
   <div class="xytinfo">
<!-- <p style="font-size: 40px; margin-top:320px; font-family:微软雅黑;">内   容   更   新   中  . . .</p> -->
   <div id="main">    
    <div class="demo">
        <div class="box">
            <img src="view/images/blk/1.jpg"  width="70%" id="img1" >
            <!-- <h4>¥<span>3499.00</span></h4> -->            
            <div class="button orange2 addcar">领 票</div>
        </div>
        <div class="box">
            <img src="view/images/blk/2.jpg" width="70%" id="img2"> 
            <a href="#" class="button orange2 addcar" >领 票</a>
        </div>
        <div class="box">
            <img src="view/images/blk/3.jpg"  width="70%" id="img3"> 
            <a href="#" class="button orange2 addcar">领 票</a>
        </div>
        <!-- <div class="box">
            <img src="view/images/blk/quan4.jpg"  >
            <a href="#" class="button orange2 addcar">领 票</a>
        </div> -->
    </div>
    
    </div>
  <!-- <div onclick="btn1()">222222</div> -->
    <div class="m-sidebar">
        <div class="cart">
            <i id="end"> </i>
             <!-- <span>购物车</span>   -->
        </div>
    </div>
    <div id="msg">已领入便利扣</div>
    
    <div>
   <!-- <form   method="post">  
  <p> <input type="text" name="num" autofocus /></p> 
  <input type="submit" value="Submit" />
</form> -->
    </div> 
</div>  

<div id="readCard" style="display: none;position: fixed;width: 1000px;height: 100px;background: rgba(243, 243, 243,0.5) none repeat scroll 0% 0%;" >
	<input id="cardInput" style="width:1px;height:1px"/>
	<div id="cardContent" style="color:red;font-size:30px;padding: 30px;text-align: center;margin-top: -20px;">请刷卡</div>
</div>
    <!-- <script type="text/javascript" src="view/js/jquery-1.10.2.min.js"></script> -->
    <!-- <script type="text/javascript" src="view/js/layer/layer.js"></script>   -->
    <script src="view/js/jquery.fly.min.js"></script>
<script>
layer.config({
    extend: 'extend/layer.ext.js'
});    
 
$(function() {
        var offset = $("#end").offset();
        var date=879279611;
        var addcar ;
        var addoffset ;
        var img ;
        var flyer; 
        
      var i=2;
       $("#img"+i).click(function() {
       $("#img2").attr("src","view/images/blk/"+i+"-1.jpg");
        });
       
       var readtimeout = null;
       var input = $("#cardInput");
       //按钮输入操作
       input.keyup(function(){
       	 //替换文字
       	 $("#cardContent").html("正在读卡，请稍后");
       	 if(readtimeout == null){
       		readtimeout = setTimeout(function(){
       		 if( date==$("#cardInput").val()){
       			 layer.closeAll();
       	         layer.msg('已领取！您的卡号：'+ $("#cardInput").val() );
       	         flyer.fly({
       	           start: {
       	               // left: event.pageX,
       	               // top: event.pageY
       	              left: addoffset.left/2,
       	              top: addoffset.top
       	           },
       	           end: {
       	               left: offset.left+10,
       	               top: offset.top+10,
       	               width: 150,
       	               height:50
       	           },
       	           onEnd: function(){
       	               $("#msg").show().animate({width: '250px'}, 500).fadeOut(3000);
       	               addcar.css("cursor","default").removeClass('orange2').unbind('click');
       	               this.destory();
       	           }
       	       }); 
       	         
       	       }
       	      else {
       	    	  layer.closeAll();
       	    	  layer.msg('本卡未注册');
       	      }
       		 
       		 input.val("");
       		 readtimeout = null;
       			
       		},1000);
       	 }
       });
     
	$(".addcar").click(function(event){
		$("#cardInput").val("");
		$("#cardContent").html("请刷卡...");
          addcar = $(this);
          addoffset=$(this).offset();
          img = addcar.parent().find('img').attr('src');
          flyer = $('<img class="u-flyer" src="'+img+'">');
          
          layer.open({
				type:1,
				title: "",
				shadeClose:true,
				shade: 0.1,
				closeBtn: 1,
			    content: $('#readCard')
			});
          $("#cardInput").focus();
	});
         
 function fly(){ 
     
     //alert("###");
    flyer.fly({
            start: {
                // left: event.pageX,
                // top: event.pageY
               left: addoffset.left/2,
               top: addoffset.top
            },
            end: {
                left: offset.left+10,
                top: offset.top+10,
                width: 150,
                height:50
            },
            onEnd: function(){
                $("#msg").show().animate({width: '250px'}, 500).fadeOut(3000);
                addcar.css("cursor","default").removeClass('orange2').unbind('click');
                this.destory();
            }
        });
 
 }
 
 //票卡券动画
   function pkq(event){
        var addcar = $(this);
        var addoffset=$(this).offset();
        var img = addcar.parent().find('img').attr('src');
        var flyer = $('<img class="u-flyer" src="'+img+'">');
        flyer.fly({
            start: {
                // left: event.pageX,
                // top: event.pageY
               left: addoffset.left/2,
               top: addoffset.top
            },
            end: {
                left: offset.left+10,
                top: offset.top+10,
                width: 150,
                height:50
            },
            onEnd: function(){
                $("#msg").show().animate({width: '250px'}, 500).fadeOut(3000);
                addcar.css("cursor","default").removeClass('orange2').unbind('click');
                this.destory();
            }
        });
   }
 
});
       
    </script>
   